# pylint: disable=line-too-long,useless-suppression
# coding=utf-8
# --------------------------------------------------------------------------
# Copyright (c) Microsoft Corporation. All rights reserved.
# Licensed under the MIT License. See License.txt in the project root for license information.
# Code generated by Microsoft (R) Python Code Generator.
# Changes may cause incorrect behavior and will be lost if the code is regenerated.
# --------------------------------------------------------------------------

from azure.identity import DefaultAzureCredential

from azure.analytics.onlineexperimentation import OnlineExperimentationClient

"""
# PREREQUISITES
    pip install azure-identity
    pip install azure-analytics-onlineexperimentation
# USAGE
    python experiment_metrics_client_create_or_update_user_rate.py

    Before run the sample, please set the values of the client ID, tenant ID and client secret
    of the AAD application as environment variables: AZURE_CLIENT_ID, AZURE_TENANT_ID,
    AZURE_CLIENT_SECRET. For more info about how to get the value, please see:
    https://docs.microsoft.com/azure/active-directory/develop/howto-create-service-principal-portal
"""


def main():
    client = OnlineExperimentationClient(
        endpoint="ENDPOINT",
        credential=DefaultAzureCredential(),
    )

    response = client.experiment_metrics_client.create_or_update(
        experiment_metric_id="rate_subscription_ad",
        resource={
            "categories": ["Monetization"],
            "definition": {
                "endEvent": {"eventName": "Subscribe", "filter": "Status == 'Success'"},
                "startEvent": {"eventName": "AdView", "filter": "Source == 'subscription_promo'"},
                "type": "UserRate",
            },
            "description": "The percentage of users who saw an advertisement for a subscription promotion and then later successfully subscribed. This metric is calculated as the number of users who successfully subscribed after seeing the advert divided by the total number of users who saw the advert. Users who saw multiple adverts or subscribed multiple times are counted only once. Users who saw the advert before the analysis period starts are excluded from this metric.",
            "desiredDirection": "Increase",
            "displayName": "Subscription ad conversion rate",
            "lifecycle": "Active",
        },
    )
    print(response)


# x-ms-original-file: 2025-05-31-preview/ExperimentMetricsClient_CreateOrUpdate_UserRate.json
if __name__ == "__main__":
    main()
