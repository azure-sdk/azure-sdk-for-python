# coding=utf-8
# --------------------------------------------------------------------------
# Copyright (c) Microsoft Corporation. All rights reserved.
# Licensed under the MIT License. See License.txt in the project root for license information.
# Code generated by Microsoft (R) AutoRest Code Generator.
# Changes may cause incorrect behavior and will be lost if the code is regenerated.
# --------------------------------------------------------------------------

from azure.identity import DefaultAzureCredential
from azure.mgmt.healthcareapis import HealthcareApisManagementClient

"""
# PREREQUISITES
    pip install azure-identity
    pip install azure-mgmt-healthcareapis
# USAGE
    python validate_medtech_mappings.py

    Before run the sample, please set the values of the client ID, tenant ID and client secret
    of the AAD application as environment variables: AZURE_CLIENT_ID, AZURE_TENANT_ID,
    AZURE_CLIENT_SECRET. For more info about how to get the value, please see:
    https://docs.microsoft.com/azure/active-directory/develop/howto-create-service-principal-portal
"""


def main():
    client = HealthcareApisManagementClient(
        credential=DefaultAzureCredential(),
        subscription_id="subid",
    )

    response = client.services.validate_medtech_mappings(
        validation_request_inputs={
            "aggregateErrors": "False",
            "deviceEvents": [
                {
                    "deviceId": "abc1",
                    "endDate": "2022-04-01T21:23:23.8429459Z",
                    "heartrate": "100",
                    "patient": "patient123",
                    "session": "abcdefg",
                },
                {
                    "deviceId": "abc2",
                    "endDate": "2022-04-01T21:23:23.8429459Z",
                    "heartrate": "100",
                    "patient": "patient123",
                    "session": "abcdefg",
                },
            ],
            "deviceMapping": {
                "content": {
                    "template": [
                        {
                            "template": {
                                "deviceIdExpression": "$.deviceId",
                                "timestampExpression": "$.endDate",
                                "typeMatchExpression": "$..[?(@heartrate)]",
                                "typeName": "heartrate",
                            },
                            "templateType": "JsonPathContent",
                        }
                    ],
                    "templateType": "CollectionContent",
                }
            },
            "fhirMapping": {
                "content": {
                    "template": [
                        {
                            "template": {
                                "codes": [
                                    {"code": "85354-9", "display": "Blood pressure panel", "system": "http://loinc.org"}
                                ],
                                "components": [
                                    {
                                        "codes": [
                                            {
                                                "code": "85354-9",
                                                "display": "Blood pressure panel",
                                                "system": "http://loinc.org",
                                            }
                                        ],
                                        "value": {
                                            "defaultPeriod": 1000,
                                            "unit": "mmHg",
                                            "valueName": "diastolic",
                                            "valueType": "SampledData",
                                        },
                                    }
                                ],
                                "periodInterval": 60,
                                "typeName": "bloodpressure",
                            },
                            "templateType": "CodeValueFhir",
                        }
                    ],
                    "templateType": "CollectionFhir",
                }
            },
        },
    )
    print(response)


# x-ms-original-file: specification/healthcareapis/resource-manager/Microsoft.HealthcareApis/preview/2022-07-01-preview/examples/ValidateMedtechMappings.json
if __name__ == "__main__":
    main()
